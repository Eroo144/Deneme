{% extends "base.html" %}

{% block content %}
<style>
    /* MOBÄ°L Ä°Ã‡Ä°N CRITICAL DÃœZENLEMELER */
    .main-posts-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
        padding-bottom: 70px; /* Alt navigasyon iÃ§in alan */
    }

    /* Mobilde tam geniÅŸlik, masaÃ¼stÃ¼nde yan yana */
    .post-create-card,
    .posts-feed-card,
    .info-sidebar-card {
        width: 100%;
        margin-bottom: 1rem;
        background: rgba(0, 0, 30, 0.9) !important;
        border-radius: 15px;
        border: 1px solid rgba(110, 142, 251, 0.3);
        padding: 1.5rem;
        backdrop-filter: blur(10px);
        color: white;
    }

    /* MasaÃ¼stÃ¼ gÃ¶rÃ¼nÃ¼mÃ¼ */
    @media (min-width: 992px) {
        .main-posts-container {
            flex-direction: row;
            height: calc(100vh - 80px);
        }
        .post-create-card {
            flex: 0 0 25%;
            height: 100%;
            overflow-y: auto;
        }
        .posts-feed-card {
            flex: 0 0 50%;
            height: 100%;
            overflow-y: auto;
        }
        .info-sidebar-card {
            flex: 0 0 23%;
            height: 100%;
            overflow-y: auto;
        }
    }

    /* GÃ¶nderi stilleri */
    .post-item {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        padding-bottom: 1rem;
        margin-bottom: 1rem;
    }
    .post-item:last-child {
        border-bottom: none;
    }

    /* Resimler iÃ§in mobil uyumlu stil */
    .post-image {
        max-width: 100%;
        border-radius: 10px;
        margin-top: 0.5rem;
    }

    /* Butonlar iÃ§in dokunmatik boyut */
    .btn-mobile {
        padding: 0.5rem 1rem;
        min-height: 44px; /* Dokunmatik uyumlu boyut */
        display: inline-flex;
        align-items: center;
        justify-content: center;
    }

    /* Mobil bottom navigation */
    .mobile-bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(10, 10, 30, 0.95);
        backdrop-filter: blur(10px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 1000;
        padding: 0.5rem 0;
    }
</style>

<div class="main-posts-container">

    <!-- SOL: GÃ¶nderi OluÅŸturma KartÄ± - MOBÄ°LDE GÄ°ZLÄ° -->
    <div class="post-create-card d-none d-lg-block">
        <h5><i class="fas fa-edit me-2"></i>GÃ¶nderi PaylaÅŸ</h5>
        <form method="POST" enctype="multipart/form-data">
            <textarea name="content" rows="3" placeholder="Neler oluyor?" class="form-control mb-2" required></textarea>
            <input type="file" name="image" accept="image/*" class="form-control mb-2" id="imageUpload">
            <button type="submit" class="btn btn-primary w-100 btn-mobile">PaylaÅŸ</button>
        </form>
    </div>

    <!-- ORTA: GÃ¶nderi AkÄ±ÅŸÄ± -->
    <div class="posts-feed-card">
        <h5><i class="fas fa-stream me-2"></i>GÃ¶nderiler</h5>
        <div class="posts-list">
            {% for post in posts %}
                <div class="post-item">
                    <div class="d-flex align-items-center mb-2">
                        <img src="{{ url_for('static', filename='profile_images/' ~ (post.author.profile_image if post.author.profile_image else 'default_avatar.png')) }}" 
                             class="rounded-circle me-2" width="40" height="40" alt="Avatar" style="object-fit: cover;">
                        <div>
                            <strong>{{ post.author.username }}</strong>
                            <br>
                            <small class="text-muted">{{ post.timestamp.strftime("%d.%m.%Y %H:%M") }}</small>
                        </div>
                    </div>

                    <p class="mb-2">{{ post.body }}</p>
                    
                    {% if post.image %}
                        <img src="{{ url_for('static', filename='post_images/' + post.image) }}" 
                             class="post-image img-fluid" 
                             alt="GÃ¶nderi resmi">
                    {% endif %}

                    <!-- BeÄŸeni/Yorum ButonlarÄ± -->
                    <div class="d-flex justify-content-around mt-3">
                        <form action="{{ url_for('like_post', post_id=post.id) }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-sm {% if post.is_liked_by(current_user) %}btn-danger{% else %}btn-outline-light{% endif %} btn-mobile">
                                <i class="fas fa-heart me-1"></i> {{ post.liked_by|length }}
                            </button>
                        </form>
                        
                        <button class="btn btn-outline-light btn-sm btn-mobile" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#commentSection{{ post.id }}" 
                                aria-expanded="false">
                            <i class="fas fa-comment me-1"></i> {{ post.post_comments|length }}
                        </button>
                    </div>

                    <!-- Yorum BÃ¶lÃ¼mÃ¼ (Collapsible) -->
                    <div class="collapse mt-3" id="commentSection{{ post.id }}">
                        <form action="{{ url_for('comment_post', post_id=post.id) }}" method="POST" class="mb-3">
                            <div class="input-group">
                                <input type="text" name="comment" class="form-control" placeholder="Yorum yaz..." required>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </form>

                        {% if post.post_comments %}
                            <div class="mt-2">
                                {% for comment in post.post_comments %}
                                    <div class="mb-2 p-2 small" style="background: rgba(255,255,255,0.05); border-radius: 8px;">
                                        <strong>{{ comment.user.username }}</strong>: 
                                        {{ comment.body }}
                                        <br>
                                        <small class="text-muted">{{ comment.timestamp.strftime("%d.%m.%Y %H:%M") }}</small>
                                    </div>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-feather-alt fa-3x mb-3 text-muted"></i>
                    <p class="text-muted">HenÃ¼z gÃ¶nderi yok. Ä°lk gÃ¶nderiyi sen paylaÅŸ!</p>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- SAÄž: Bilgilendirme - MOBÄ°LDE GÄ°ZLÄ° -->
    <div class="info-sidebar-card d-none d-lg-block">
        <h5><i class="fas fa-info-circle me-2"></i>Bilgilendirme</h5>
        <p class="small">Topluluk kurallarÄ±na uymayÄ± unutmayÄ±n. ðŸ˜Š</p>
        
        <div class="mt-3">
            <h6><i class="fas fa-calendar-alt me-2"></i>YaklaÅŸan Etkinlikler</h6>
            <div class="small">
                <div class="mb-2">ðŸ“… <strong>YÄ±ldÄ±z GÃ¶zlem Gecesi</strong><br><small>15 Temmuz</small></div>
                <div class="mb-2">ðŸŽ¬ <strong>Film Gecesi</strong><br><small>22 Temmuz</small></div>
            </div>
        </div>
    </div>

</div>

<!-- Mobil Bottom Navigation -->
<nav class="mobile-bottom-nav d-lg-none">
    <div class="container">
        <div class="d-flex justify-content-around">
            <a href="{{ url_for('posts') }}" class="btn btn-sm btn-outline-light d-flex flex-column align-items-center py-2">
                <i class="fas fa-home mb-1"></i>
                <small>Ana Sayfa</small>
            </a>
            <a href="{{ url_for('profile') }}" class="btn btn-sm btn-outline-light d-flex flex-column align-items-center py-2">
                <i class="fas fa-user mb-1"></i>
                <small>Profil</small>
            </a>
            <button class="btn btn-primary btn-sm d-flex flex-column align-items-center py-2" data-bs-toggle="modal" data-bs-target="#quickPostModal">
                <i class="fas fa-plus mb-1"></i>
                <small>GÃ¶nderi</small>
            </button>
            <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-light d-flex flex-column align-items-center py-2">
                <i class="fas fa-sign-out-alt mb-1"></i>
                <small>Ã‡Ä±kÄ±ÅŸ</small>
            </a>
        </div>
    </div>
</nav>

<!-- HÄ±zlÄ± GÃ¶nderi Modal (Mobil iÃ§in) -->
<div class="modal fade" id="quickPostModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background: rgba(0, 0, 30, 0.95); border: 1px solid rgba(110, 142, 251, 0.3);">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-edit me-2"></i>GÃ¶nderi PaylaÅŸ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" enctype="multipart/form-data" action="{{ url_for('posts') }}">
                    <textarea name="content" rows="4" class="form-control mb-3" placeholder="Neler oluyor?" required></textarea>
                    <input type="file" name="image" accept="image/*" class="form-control mb-3" id="mobileImageUpload">
                    <button type="submit" class="btn btn-primary w-100 btn-mobile">PaylaÅŸ</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Mobil iÃ§in resim yÃ¼kleme uyarÄ±sÄ±
document.getElementById('mobileImageUpload')?.addEventListener('change', function(e) {
    if (e.target.files[0] && e.target.files[0].size > 2 * 1024 * 1024) {
        alert('Resim boyutu 2MB\'dan kÃ¼Ã§Ã¼k olmalÄ±dÄ±r.');
        e.target.value = '';
    }
});
</script>
{% endblock %}